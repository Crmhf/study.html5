
# 共享线程处理多用户并发

## 基础
线程构建以及销毁需要消耗很多系统性能，如：CPU的处理器调度，内存的占用回收
一般编程语言有线程池，线程池对多线程并发处理，在处理过程中系统将所有的任务添加到一个任务队列，
然后构建好线程池以后自动启动这些任务。
处理完任务后再把线程收回到线程池中，用于下一次任务调度。
线程池也是共享线程的一种应用。

## HTML5的共享线程
每个共享线程有多个连接，HTML5对共享线程提供了和普通工作线程稍微有些区别的API接口。

## 例子
创建一个共享线程用于接收不同连接发送过来的指令，然后实现自己的执行处理逻辑，
指令处理完成后将结果返回给各个不同的连接用户

## 说明
主页面即各个用户连接页面构造出一个共享线程对象，然后定义一个方法postMessageToSharedWorker
向共享线程发送来至用户的指令。
同时，在共享线程的实现代码片段中定义onconnect事件处理器接收来自不同用户的连接，解析它们传递过来的指令。
最后，定义一个execute_instruction用于执行用户的指令，指令执行完成后将结果返回给每个用户。

## 其他
如果使用了addEventListener来接受来自共享线程的消息，就要使用worker.port.start()方法来启动这个端口。
之后就能像工作线程的使用方式一样正常的接收和发送消息。